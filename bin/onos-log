#!/bin/bash
# -----------------------------------------------------------------------------
# Monitors remote ONOS log file on the specified ONOS container.
# -----------------------------------------------------------------------------

function _usage () {
cat << _EOF_
usage: $(basename $0) [node]

ONOS log reviewer.

Parameters:
  - node          ip or hostname of cluster node to attach to

If node is unspecified, the value of \$OC1 environment variable is used.
_EOF_
}

[ "$1" = "-h" ] || [ "$1" = '-?' ] && _usage && exit 0

# shellcheck disable=SC1091
source envSetup

OCI=$OC1
[ -n "$1" ] && OCI=$1 && shift

remote=sdn@${OCI}

LOG=/root/onos/apache-karaf-3.0.8/data/log/karaf.log

ssh -t $remote "sudo docker exec -it onos /bin/bash -c '
while true; do
    echo ==================================================================
    [ ! -f $LOG ] && sleep 2 && continue
    tail -n 512 -f -F $LOG || tail -n 512 -s 2
done
'"
